// –ò–ò Triage –∞–Ω–∞–ª–∏–∑ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Å–∏–º–ø—Ç–æ–º–æ–≤
export async function getTriageAnalysis({ symptomsDescription }: { symptomsDescription: string }) {
  try {
    // –ü–æ–ª—É—á–∞–µ–º API –∫–ª—é—á –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ –∫–ª—é—á
    const apiKey = (import.meta as any).env.VITE_GOOGLE_AI_API_KEY || 'demo-key';
    
    if (apiKey === 'demo-key') {
      // Fallback –Ω–∞ —É–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –µ—Å–ª–∏ –Ω–µ—Ç API –∫–ª—é—á–∞
      return getSmartFallbackTriage(symptomsDescription);
    }

    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        contents: [{
          parts: [{
            text: `–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç-–≥–∏–Ω–µ–∫–æ–ª–æ–≥ —Å 20-–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –≤–µ–¥–µ–Ω–∏–∏ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–∏–∞–∂ —Å–∏–º–ø—Ç–æ–º–æ–≤ —É –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∂–µ–Ω—â–∏–Ω.

üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –°–ò–ú–ü–¢–û–ú–´ (–í–°–ï–ì–î–ê –í–´–°–û–ö–ò–ô –†–ò–°–ö):
- –õ—é–±–æ–µ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ (–∫—Ä–æ–≤—å, –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ, –∫—Ä–æ–≤–∏—Ç, –º–∞–∂—É—â–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å –∫—Ä–æ–≤—å—é)
- –°–∏–ª—å–Ω—ã–µ –±–æ–ª–∏ –≤ –∂–∏–≤–æ—Ç–µ + –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ
- –°–•–í–ê–¢–ö–ò –ù–ê –õ–Æ–ë–û–ú –°–†–û–ö–ï –ë–ï–†–ï–ú–ï–ù–ù–û–°–¢–ò (—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è, –±–æ–ª–∏ –∫–∞–∫ –ø—Ä–∏ –º–µ—Å—è—á–Ω—ã—Ö)
- –ü–æ—Ç–µ—Ä—è —Å–æ–∑–Ω–∞–Ω–∏—è, —Å—É–¥–æ—Ä–æ–≥–∏, –æ–±–º–æ—Ä–æ–∫–∏
- –í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (38.5¬∞C+) + –±–æ–ª–∏ –≤ –∂–∏–≤–æ—Ç–µ
- –û—Å—Ç—Ä–∞—è –±–æ–ª—å –≤ –ø—Ä–∞–≤–æ–º –±–æ–∫—É (–ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –∞–ø–ø–µ–Ω–¥–∏—Ü–∏—Ç)
- –°–∏–ª—å–Ω–∞—è –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å + –Ω–∞—Ä—É—à–µ–Ω–∏—è –∑—Ä–µ–Ω–∏—è
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —à–µ–≤–µ–ª–µ–Ω–∏–π –ø–ª–æ–¥–∞ –ø–æ—Å–ª–µ 28 –Ω–µ–¥–µ–ª—å

‚ö†Ô∏è –í–ê–ñ–ù–û: –°–ª–æ–≤–æ "—Å—Ö–≤–∞—Ç–∫–∏" = –í–°–ï–ì–î–ê –í–´–°–û–ö–ò–ô –†–ò–°–ö! –î–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Å—Ö–≤–∞—Ç–∫–∏ –ë—Ä–µ–∫—Å—Ç–æ–Ω–∞-–•–∏–∫—Å–∞, –∏—Ö –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É –≤—Ä–∞—á–∞.

üìä –ê–ù–ê–õ–ò–ó –°–ò–ú–ü–¢–û–ú–û–í: "${symptomsDescription}"

üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó:
1. –£–†–û–í–ï–ù–¨ –†–ò–°–ö–ê: low/medium/high (–∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ = –í–°–ï–ì–î–ê high)
2. –û–°–ù–û–í–ù–´–ï –°–ò–ú–ü–¢–û–ú–´: —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
3. –¢–Ø–ñ–ï–°–¢–¨: mild/moderate/severe –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–ø—Ç–æ–º–∞
4. –°–†–û–ß–ù–û–°–¢–¨: low/medium/high
5. –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò: –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏
6. –û–ë–£–ß–ï–ù–ò–ï: —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —É—Ä–æ–∫–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

üìö –î–û–°–¢–£–ü–ù–´–ï –£–†–û–ö–ò –í –ü–†–ò–õ–û–ñ–ï–ù–ò–ò:

–û–°–ù–û–í–´ –ë–ï–†–ï–ú–ï–ù–ù–û–°–¢–ò:
- "–ü–∏—Ç–∞–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏" (pregnancy-nutrition) - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è –∑–¥–æ—Ä–æ–≤–æ–π –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏
- "–§–∏–∑–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è" (pregnancy-exercise) - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö  
- "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–æ–¥–∞–º" (pregnancy-preparation) - –ö–∞–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Ä–æ–¥–∞–º
- "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ" (pregnancy-emotional) - –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è

–ü–û–°–õ–ï–†–û–î–û–í–û–ô –ü–ï–†–ò–û–î:
- "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞" (postpartum-recovery) - –§–∏–∑–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–æ–¥–æ–≤
- "–ì—Ä—É–¥–Ω–æ–µ –≤—Å–∫–∞—Ä–º–ª–∏–≤–∞–Ω–∏–µ" (breastfeeding) - –û—Å–Ω–æ–≤—ã —É—Å–ø–µ—à–Ω–æ–≥–æ –≥—Ä—É–¥–Ω–æ–≥–æ –≤—Å–∫–∞—Ä–º–ª–∏–≤–∞–Ω–∏—è
- "–ü–æ—Å–ª–µ—Ä–æ–¥–æ–≤–∞—è –¥–µ–ø—Ä–µ—Å—Å–∏—è" (postpartum-depression) - –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∏ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ—Ä–æ–¥–æ–≤–æ–π –¥–µ–ø—Ä–µ—Å—Å–∏–∏
- "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å" (postpartum-activity) - –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–£–•–û–î –ó–ê –†–ï–ë–ï–ù–ö–û–ú:
- "–ö–æ—Ä–º–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞" (baby-feeding) - –û—Å–Ω–æ–≤—ã –∫–æ—Ä–º–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω–æ–≥–æ
- "–°–æ–Ω –Ω–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω–æ–≥–æ" (baby-sleep) - –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Å–Ω–∞
- "–ì–∏–≥–∏–µ–Ω–∞ —Ä–µ–±–µ–Ω–∫–∞" (baby-hygiene) - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —É—Ö–æ–¥ –∑–∞ –Ω–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã–º
- "–†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ–±–µ–Ω–∫–∞" (baby-development) - –≠—Ç–∞–ø—ã —Ä–∞–∑–≤–∏—Ç–∏—è –≤ –ø–µ—Ä–≤—ã–π –≥–æ–¥

üí° –ü–†–ê–í–ò–õ–ê –ê–ù–ê–õ–ò–ó–ê:
- –ü—Ä–∏ –ù–ò–ó–ö–û–ú —Ä–∏—Å–∫–µ: –¥–∞–π —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π + —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ
- –ü—Ä–∏ –°–†–ï–î–ù–ï–ú —Ä–∏—Å–∫–µ: –æ–±—ä—è—Å–Ω–∏ —Å–∏—Ç—É–∞—Ü–∏—é + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ + –æ–±—É—á–µ–Ω–∏–µ
- –ü—Ä–∏ –í–´–°–û–ö–û–ú —Ä–∏—Å–∫–µ: —Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è + —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –º–µ—Ä—ã

–û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "riskLevel": "low/medium/high",
  "symptoms": [
    {
      "name": "–¥–µ—Ç–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∏–º–ø—Ç–æ–º–∞",
      "severity": "mild/moderate/severe",
      "urgency": "low/medium/high",
      "description": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏–º–ø—Ç–æ–º–∞"
    }
  ],
  "recommendations": "–¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏",
  "emergencyActions": "–¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)",
  "personalComment": "–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤—Ä–∞—á–∞ —Å –∞–Ω–∞–ª–∏–∑–æ–º —Å–∏—Ç—É–∞—Ü–∏–∏",
  "educationLinks": [
    {
      "title": "–Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞",
      "link": "—É—Ä–æ–∫-X-–Ω–∞–∑–≤–∞–Ω–∏–µ",
      "description": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞"
    }
  ],
  "comfortingMessage": "—É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ–π (–µ—Å–ª–∏ –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫)",
  "followUpAdvice": "—Å–æ–≤–µ—Ç—ã –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É –Ω–∞–±–ª—é–¥–µ–Ω–∏—é"
}

üö® –ü–û–ú–ù–ò: –ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ —É –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö = –í–´–°–û–ö–ò–ô –†–ò–°–ö! –í—Å–µ–≥–¥–∞ –±—É–¥—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º –∫ –¥–µ—Ç–∞–ª—è–º –∏ –¥–∞–≤–∞–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã.`
          }]
        }],
        generationConfig: {
          temperature: 0.3,
          topK: 20,
          topP: 0.8,
          maxOutputTokens: 1024,
        }
      })
    });

    if (!response.ok) {
      throw new Error(`API Error: ${response.status}`);
    }

    const data = await response.json();
    const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || '–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞';
    
          try {
            const analysis = JSON.parse(aiResponse);
            return {
              success: true,
              riskLevel: analysis.riskLevel || 'medium',
              symptoms: analysis.symptoms || [],
              recommendations: analysis.recommendations || '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.',
              emergencyActions: analysis.emergencyActions || null,
              personalComment: analysis.personalComment || null,
              educationLinks: analysis.educationLinks || [],
              comfortingMessage: analysis.comfortingMessage || null,
              followUpAdvice: analysis.followUpAdvice || null
            };
          } catch (parseError) {
            console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ò–ò –æ—Ç–≤–µ—Ç–∞:', parseError);
            return getSmartFallbackTriage(symptomsDescription);
          }

  } catch (error) {
    console.error('AI Triage Error:', error);
    return getSmartFallbackTriage(symptomsDescription);
  }
}

// –£–º–Ω—ã–π fallback –∞–Ω–∞–ª–∏–∑
function getSmartFallbackTriage(symptomsDescription: string) {
  const description = symptomsDescription.toLowerCase();
  
  // –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å–∏–º–ø—Ç–æ–º–æ–≤
  const getRiskLevel = (desc: string) => {
    // –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ —Å–∏–º–ø—Ç–æ–º–æ–≤
    const intensityWords = {
      critical: ['–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏', '–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ', '—ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ', '—ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è', '–Ω–µ—Å—Ç–µ—Ä–ø–∏–º–æ', '–Ω–µ—Å—Ç–µ—Ä–ø–∏–º–∞—è', '–º—É—á–∏—Ç–µ–ª—å–Ω–æ', '–º—É—á–∏—Ç–µ–ª—å–Ω–∞—è', '—É–∂–∞—Å–Ω–æ', '—É–∂–∞—Å–Ω–∞—è'],
      high: ['–æ—á–µ–Ω—å', '—Å–∏–ª—å–Ω–æ', '—Å–∏–ª—å–Ω–∞—è', '—Å–∏–ª—å–Ω—ã–µ', '–æ—Å—Ç—Ä–∞—è', '–æ—Å—Ç—Ä–∞—è', '–Ω–µ–≤—ã–Ω–æ—Å–∏–º–æ', '–Ω–µ–≤—ã–Ω–æ—Å–∏–º–∞—è', '–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ', '–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è'],
      medium: ['–¥–æ–≤–æ–ª—å–Ω–æ', '–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ', '–∑–∞–º–µ—Ç–Ω–æ', '–æ—â—É—Ç–∏–º–æ', '—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ', '—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è'],
      low: ['—Å–ª–µ–≥–∫–∞', '–Ω–µ–º–Ω–æ–≥–æ', '—á—É—Ç—å-—á—É—Ç—å', '–ª–µ–≥–∫–æ', '–ª–µ–≥–∫–∞—è', '–ª–µ–≥–∫–∏–µ', '—Å–ª–∞–±–æ', '—Å–ª–∞–±–∞—è']
    };

    // –ê–Ω–∞–ª–∏–∑ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏–º–ø—Ç–æ–º–æ–≤
    const criticalLocations = ['–∂–∏–≤–æ—Ç', '–∂–∏–≤–æ—Ç–µ', '–Ω–∏–∑—É –∂–∏–≤–æ—Ç–∞', '–Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ –∂–∏–≤–æ—Ç–∞', '—Ç–∞–∑', '—Ç–∞–∑–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏'];
    const pregnancyTerms = ['—Ç—Ä–∏–º–µ—Å—Ç—Ä', '—Ç—Ä–∏–º–µ—Å—Ç—Ä–µ', '—Å—Ä–æ–∫', '—Å—Ä–æ–∫–∞—Ö', '–±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏', '–±–µ—Ä–µ–º–µ–Ω–Ω–∞—è', '–±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏'];
    
    // –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    const timeIndicators = ['—á–∞—Å–æ–≤', '–º–∏–Ω—É—Ç', '–¥–Ω–µ–π', '–Ω–µ–¥–µ–ª—å', '–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è', '–¥–ª–∏—Ç—Å—è', '—É–∂–µ'];
    const urgentTime = ['—Å–µ–π—á–∞—Å', '—Ç–æ–ª—å–∫–æ —á—Ç–æ', '–≤–Ω–µ–∑–∞–ø–Ω–æ', '—Ä–µ–∑–∫–æ', '–º–≥–Ω–æ–≤–µ–Ω–Ω–æ'];
    
    // –ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    const emotionalWords = ['–±–æ—é—Å—å', '—Å—Ç—Ä–∞—à–Ω–æ', '–ø–∞–Ω–∏–∫–∞', '–ø–∞–Ω–∏–∫—É—é', '–≤–æ–ª–Ω—É—é—Å—å', '–ø–µ—Ä–µ–∂–∏–≤–∞—é', '—Ç—Ä–µ–≤–æ–∂–Ω–æ'];
    
    // –ü–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤ —Ä–∏—Å–∫–∞
    let riskScore = 0;
    
    // 1. –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
    for (const [level, words] of Object.entries(intensityWords)) {
      const foundWords = words.filter(word => desc.includes(word));
      if (foundWords.length > 0) {
        switch (level) {
          case 'critical': riskScore += 40; break;
          case 'high': riskScore += 25; break;
          case 'medium': riskScore += 10; break;
          case 'low': riskScore += 2; break;
        }
      }
    }
    
    // 2. –ê–Ω–∞–ª–∏–∑ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏)
    const hasCriticalLocation = criticalLocations.some(loc => desc.includes(loc));
    const hasPregnancyContext = pregnancyTerms.some(term => desc.includes(term));
    
    if (hasCriticalLocation && hasPregnancyContext) {
      riskScore += 35; // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
    } else if (hasCriticalLocation) {
      riskScore += 20;
    }
    
    // 3. –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏
    const hasTimeUrgency = urgentTime.some(time => desc.includes(time));
    const hasTimeDuration = timeIndicators.some(time => desc.includes(time));
    
    if (hasTimeUrgency) riskScore += 15;
    if (hasTimeDuration) riskScore += 5;
    
    // 4. –ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    const hasEmotionalStress = emotionalWords.some(emotion => desc.includes(emotion));
    if (hasEmotionalStress) riskScore += 10;
    
    // 5. –ê–Ω–∞–ª–∏–∑ –¥–ª–∏–Ω—ã –∏ –¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç–∏ –æ–ø–∏—Å–∞–Ω–∏—è
    if (desc.length > 200) riskScore += 5; // –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    if (desc.length > 100) riskScore += 3;
    
    // 6. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
    const medicalTerms = {
      critical: ['–∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ', '–∫—Ä–æ–≤—å', '—Å—É–¥–æ—Ä–æ–≥–∏', '—Å—É–¥–æ—Ä–æ–≥–∞', '–ø–æ—Ç–µ—Ä—è —Å–æ–∑–Ω–∞–Ω–∏—è', '–æ–±–º–æ—Ä–æ–∫'],
      high: ['—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', '–∂–∞—Ä', '—Ä–≤–æ—Ç–∞', '—Ç–æ—à–Ω–æ—Ç–∞', '–≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ', '—Å–ª–∞–±–æ—Å—Ç—å'],
      medium: ['–±–æ–ª—å', '–±–æ–ª–∏—Ç', '–¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç', '–Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–µ –æ—â—É—â–µ–Ω–∏—è']
    };
    
    let medicalScore = 0;
    for (const [level, terms] of Object.entries(medicalTerms)) {
      const foundTerms = terms.filter(term => desc.includes(term));
      if (foundTerms.length > 0) {
        switch (level) {
          case 'critical': medicalScore += foundTerms.length * 15; break;
          case 'high': medicalScore += foundTerms.length * 10; break;
          case 'medium': medicalScore += foundTerms.length * 5; break;
        }
      }
    }
    riskScore += medicalScore;
    
    // 7. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–∏–º–ø—Ç–æ–º–æ–≤ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ)
    const criticalCombinations = [
      { symptoms: ['–±–æ–ª—å', '–∂–∏–≤–æ—Ç', '–∫—Ä–æ–≤—å'], score: 50 }, // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
      { symptoms: ['–±–æ–ª—å', '–Ω–∏–∑—É –∂–∏–≤–æ—Ç–∞', '–∫—Ä–æ–≤—å'], score: 60 }, // –ï—â–µ –±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è
      { symptoms: ['—Å—Ö–≤–∞—Ç–∫–∏', '–∂–∏–≤–æ—Ç', '–±–µ—Ä–µ–º–µ–Ω–Ω'], score: 30 },
      { symptoms: ['—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', '–±–æ–ª—å', '–∂–∏–≤–æ—Ç'], score: 20 },
      { symptoms: ['—Ä–≤–æ—Ç–∞', '–±–æ–ª—å', '–∂–∏–≤–æ—Ç'], score: 18 },
      { symptoms: ['–∫—Ä–æ–≤—å', '–±–µ—Ä–µ–º–µ–Ω–Ω'], score: 50 }, // –ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –ø—Ä–∏ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ = –∫—Ä–∏—Ç–∏—á–Ω–æ
      { symptoms: ['–∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ', '–±–µ—Ä–µ–º–µ–Ω–Ω'], score: 55 },
      { symptoms: ['—Å—É–¥–æ—Ä–æ–≥–∏', '–±–µ—Ä–µ–º–µ–Ω–Ω'], score: 40 }
    ];
    
    for (const combo of criticalCombinations) {
      const foundSymptoms = combo.symptoms.filter(symptom => desc.includes(symptom));
      if (foundSymptoms.length >= 2) {
        riskScore += combo.score;
        console.log(`Critical combination found: ${foundSymptoms.join(', ')} (+${combo.score} points)`);
      }
    }
    
    // 8. –ê–Ω–∞–ª–∏–∑ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–ª–æ–≤ (—É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å)
    const words = desc.split(/\s+/);
    const wordCounts: Record<string, number> = {};
    words.forEach(word => {
      wordCounts[word] = (wordCounts[word] || 0) + 1;
    });
    const repeatedWords = Object.values(wordCounts).filter((count: number) => count > 1).length;
    riskScore += repeatedWords * 3;
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤
    if (desc.includes('–∫—Ä–æ–≤—å') || desc.includes('–∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ') || desc.includes('–∫—Ä–æ–≤–∏—Ç')) {
      console.log('CRITICAL: Blood detected - forcing HIGH risk');
      return 'high';
    }
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Å—Ö–≤–∞—Ç–æ–∫
    if (desc.includes('—Å—Ö–≤–∞—Ç–∫–∏') || desc.includes('—Å–æ–∫—Ä–∞—â–µ–Ω–∏—è') || desc.includes('—Å—Ö–≤–∞—Ç–∫–∞')) {
      console.log('CRITICAL: Contractions detected - forcing HIGH risk');
      return 'high';
    }
    
    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Ä–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—á–∫–æ–≤
    console.log('Risk score calculated:', riskScore);
    
    if (riskScore >= 60) return 'high';
    if (riskScore >= 30) return 'medium';
    return 'low';
  };
  
  let riskLevel = getRiskLevel(description);
  
  // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  console.log('–ê–Ω–∞–ª–∏–∑ —Å–∏–º–ø—Ç–æ–º–æ–≤:', {
    description: symptomsDescription,
    riskLevel,
    descriptionLength: description.length
  });
  
  // –£–º–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
  const getRecommendations = (risk: string, desc: string) => {
    // –ê–Ω–∞–ª–∏–∑ —Å–∏–º–ø—Ç–æ–º–æ–≤
    const symptoms = {
      pain: /–±–æ–ª—å|–±–æ–ª–∏—Ç|–±–æ–ª–µ–≤—ã–µ|–±–æ–ª–µ–∑–Ω–µ–Ω–Ω/i.test(desc),
      abdominalPain: /–∂–∏–≤–æ—Ç|–∂–∏–≤–æ—Ç–µ|–Ω–∏–∑—É –∂–∏–≤–æ—Ç–∞|—Ç–∞–∑/i.test(desc),
      nausea: /—Ç–æ—à–Ω–æ—Ç–∞|—Ä–≤–æ—Ç–∞|—Ç–æ—à–Ω–∏—Ç/i.test(desc),
      bleeding: /–∫—Ä–æ–≤—å|–∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ|–∫—Ä–æ–≤–∏—Ç/i.test(desc),
      temperature: /—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞|–∂–∞—Ä|–≥–æ—Ä—è—á/i.test(desc),
      breathing: /–¥—ã—à–∞—Ç—å|–¥—ã—Ö–∞–Ω–∏–µ|–∑–∞–¥—ã—Ö–∞—é—Å—å/i.test(desc),
      dizziness: /–≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ|–∫—Ä—É–∂–∏—Ç—Å—è|—Å–ª–∞–±–æ—Å—Ç—å/i.test(desc),
      contractions: /—Å—Ö–≤–∞—Ç–∫–∏|—Å—Ö–≤–∞—Ç–∫–æ–æ–±—Ä–∞–∑–Ω|—Å–æ–∫—Ä–∞—â–µ–Ω–∏—è/i.test(desc)
    };
    
    // –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏
    const pregnancyContext = {
      trimester: /—Ç—Ä–∏–º–µ—Å—Ç—Ä|—Å—Ä–æ–∫|–±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/i.test(desc),
      thirdTrimester: /3 —Ç—Ä–∏–º–µ—Å—Ç—Ä|—Ç—Ä–µ—Ç–∏–π —Ç—Ä–∏–º–µ—Å—Ç—Ä|–ø–æ–∑–¥–Ω–∏—Ö —Å—Ä–æ–∫–∞—Ö/i.test(desc),
      timeDuration: /—á–∞—Å–æ–≤|–º–∏–Ω—É—Ç|–¥–Ω–µ–π|–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è|–¥–ª–∏—Ç—Å—è/i.test(desc),
      urgency: /—Å–µ–π—á–∞—Å|–≤–Ω–µ–∑–∞–ø–Ω–æ|—Ä–µ–∑–∫–æ|—Ç–æ–ª—å–∫–æ —á—Ç–æ/i.test(desc)
    };
    
    // –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
    // const intensity = {
    //   critical: /–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏|—ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ|–Ω–µ—Å—Ç–µ—Ä–ø–∏–º–æ|–º—É—á–∏—Ç–µ–ª—å–Ω–æ/i.test(desc),
    //   high: /–æ—á–µ–Ω—å|—Å–∏–ª—å–Ω–æ|—Å–∏–ª—å–Ω–∞—è|–Ω–µ–≤—ã–Ω–æ—Å–∏–º–æ|—É–∂–∞—Å–Ω–æ/i.test(desc),
    //   medium: /–¥–æ–≤–æ–ª—å–Ω–æ|–∑–∞–º–µ—Ç–Ω–æ|–æ—â—É—Ç–∏–º–æ/i.test(desc),
    //   low: /—Å–ª–µ–≥–∫–∞|–Ω–µ–º–Ω–æ–≥–æ|–ª–µ–≥–∫–æ/i.test(desc)
    // };
    
    if (risk === 'high') {
      let specificAdvice = '';
      let emergencyActions = '';
      let generalAdvice = '';
      
      // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –°–õ–£–ß–ê–ò
      if (symptoms.abdominalPain && pregnancyContext.thirdTrimester) {
        emergencyActions += 'üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø: –ë–æ–ª–∏ –≤ –∂–∏–≤–æ—Ç–µ –Ω–∞ –ø–æ–∑–¥–Ω–∏—Ö —Å—Ä–æ–∫–∞—Ö!\n';
        emergencyActions += '‚Ä¢ –ù–ï–ú–ï–î–õ–ï–ù–ù–û –≤—ã–∑–æ–≤–∏—Ç–µ —Å–∫–æ—Ä—É—é –ø–æ–º–æ—â—å (103)\n';
        emergencyActions += '‚Ä¢ –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—á–∞–ª–æ–º —Ä–æ–¥–æ–≤ –∏–ª–∏ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–µ–º\n';
        emergencyActions += '‚Ä¢ –°–æ–æ–±—â–∏—Ç–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É –æ —Å—Ä–æ–∫–µ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏\n';
        emergencyActions += '‚Ä¢ –°–æ–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –≤–µ—â–∏ –¥–ª—è —Ä–æ–¥–¥–æ–º–∞\n\n';
      }
      
      if (symptoms.bleeding) {
        emergencyActions += '‚Ä¢ –ü—Ä–∏ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–∏ - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑–æ–≤–∏—Ç–µ —Å–∫–æ—Ä—É—é –ø–æ–º–æ—â—å\n';
        emergencyActions += '‚Ä¢ –ü—Ä–∏–ª–æ–∂–∏—Ç–µ —á–∏—Å—Ç—É—é —Ç–∫–∞–Ω—å –∫ –º–µ—Å—Ç—É –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏—è\n';
        emergencyActions += '‚Ä¢ –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∞–º–ø–æ–Ω—ã –ø—Ä–∏ –≤–∞–≥–∏–Ω–∞–ª—å–Ω–æ–º –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–∏\n\n';
      }
      
      if (symptoms.contractions && pregnancyContext.thirdTrimester) {
        emergencyActions += '‚Ä¢ –ü—Ä–∏ —Å—Ö–≤–∞—Ç–∫–∞—Ö –Ω–∞ –ø–æ–∑–¥–Ω–∏—Ö —Å—Ä–æ–∫–∞—Ö - —Å—Ä–æ—á–Ω–æ –≤ —Ä–æ–¥–¥–æ–º\n';
        emergencyActions += '‚Ä¢ –ó–∞—Å–µ–∫–∞–π—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É —Å—Ö–≤–∞—Ç–∫–∞–º–∏\n';
        emergencyActions += '‚Ä¢ –ü—Ä–∏ —Å—Ö–≤–∞—Ç–∫–∞—Ö –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç - –µ—Ö–∞—Ç—å –≤ —Ä–æ–¥–¥–æ–º\n\n';
      }
      
      // –°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–ï –°–û–í–ï–¢–´
      if (symptoms.temperature) {
        specificAdvice += '‚Ä¢ –ò–∑–º–µ—Ä—å—Ç–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∏ –∑–∞–ø–∏—à–∏—Ç–µ –≤—Ä–µ–º—è\n';
        specificAdvice += '‚Ä¢ –ü—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –≤—ã—à–µ 38.5¬∞C - —Å—Ä–æ—á–Ω–æ –∫ –≤—Ä–∞—á—É\n';
        specificAdvice += '‚Ä¢ –ü–µ–π—Ç–µ –±–æ–ª—å—à–µ –∂–∏–¥–∫–æ—Å—Ç–∏\n';
      }
      
      if (symptoms.breathing) {
        specificAdvice += '‚Ä¢ –ü—Ä–∏ –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–Ω–æ–º –¥—ã—Ö–∞–Ω–∏–∏ - —Å—Ä–æ—á–Ω–æ –∫ –≤—Ä–∞—á—É\n';
        specificAdvice += '‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—ã—à–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ –∏ –≥–ª—É–±–æ–∫–æ\n';
        specificAdvice += '‚Ä¢ –ü—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–π—Ç–µ —Å–∫–æ—Ä—É—é\n';
      }
      
      if (symptoms.pain && !symptoms.abdominalPain) {
        specificAdvice += '‚Ä¢ –ü—Ä–∏ —Å–∏–ª—å–Ω–æ–π –±–æ–ª–∏ - –Ω–µ —Ç–µ—Ä–ø–∏—Ç–µ, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–º–æ—â—å—é\n';
        specificAdvice += '‚Ä¢ –ù–µ –ø—Ä–∏–Ω–∏–º–∞–π—Ç–µ –æ–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–∏–µ –±–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤—Ä–∞—á–∞\n';
        specificAdvice += '‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏\n';
      }
      
      // –û–ë–©–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò
      generalAdvice += '‚Ä¢ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –∏–ª–∏ –≤—ã–∑–æ–≤–∏—Ç–µ —Å–∫–æ—Ä—É—é –ø–æ–º–æ—â—å (103)\n';
      generalAdvice += '‚Ä¢ –ù–µ –ø—Ä–∏–Ω–∏–º–∞–π—Ç–µ –Ω–∏–∫–∞–∫–∏—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤ –±–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤—Ä–∞—á–∞\n';
      generalAdvice += '‚Ä¢ –°–æ–æ–±—â–∏—Ç–µ –≤—Ä–∞—á—É –æ –≤—Å–µ—Ö —Å–∏–º–ø—Ç–æ–º–∞—Ö –∏ –∏—Ö –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n';
      generalAdvice += '‚Ä¢ –ü—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è - –Ω–µ –∂–¥–∏—Ç–µ, –≤—ã–∑—ã–≤–∞–π—Ç–µ —Å–∫–æ—Ä—É—é\n';
      generalAdvice += '‚Ä¢ –í–∞—à–µ –∑–¥–æ—Ä–æ–≤—å–µ –∏ –∑–¥–æ—Ä–æ–≤—å–µ –º–∞–ª—ã—à–∞ - —ç—Ç–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç!';
      
      return `üö® –í–ù–ò–ú–ê–ù–ò–ï: –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞!

${emergencyActions}${specificAdvice}

–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
${generalAdvice}`;
    }
    
    if (risk === 'medium') {
      let specificAdvice = '';
      
      if (symptoms.nausea) {
        specificAdvice += '‚Ä¢ –ü—Ä–∏ —Ç–æ—à–Ω–æ—Ç–µ - –ø–µ–π—Ç–µ –≤–æ–¥—É –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –≥–ª–æ—Ç–∫–∞–º–∏\n';
        specificAdvice += '‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä–µ–∑–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏–π\n';
      }
      
      if (symptoms.pain) {
        specificAdvice += '‚Ä¢ –ü—Ä–∏ –±–æ–ª–∏ - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏\n';
        specificAdvice += '‚Ä¢ –û—Ç–¥—ã—Ö–∞–π—Ç–µ –≤ —É–¥–æ–±–Ω–æ–π –ø–æ–∑–µ\n';
      }
      
      return `‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞

${specificAdvice}

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –≤ –±–ª–∏–∂–∞–π—à–∏–µ 24-48 —á–∞—Å–æ–≤
‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∏–º–ø—Ç–æ–º–∞—Ö
‚Ä¢ –ü—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É
‚Ä¢ –ü–µ–π—Ç–µ –±–æ–ª—å—à–µ –≤–æ–¥—ã –∏ –æ—Ç–¥—ã—Ö–∞–π—Ç–µ
‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
‚Ä¢ –í–µ–¥–∏—Ç–µ –¥–Ω–µ–≤–Ω–∏–∫ —Å–∏–º–ø—Ç–æ–º–æ–≤

–ï—Å–ª–∏ —Å–∏–º–ø—Ç–æ–º—ã —É—Ö—É–¥—à–∞—é—Ç—Å—è –∏–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ - –Ω–µ –∂–¥–∏—Ç–µ, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É.`;
    }
    
    return `‚úÖ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
‚Ä¢ –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å–≤–æ–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
‚Ä¢ –ü—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ —Å–∏–º–ø—Ç–æ–º–æ–≤ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É
‚Ä¢ –°–æ–±–ª—é–¥–∞–π—Ç–µ —Ä–µ–∂–∏–º –¥–Ω—è –∏ –∑–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ
‚Ä¢ –ü–µ–π—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–¥—ã (8-10 —Å—Ç–∞–∫–∞–Ω–æ–≤ –≤ –¥–µ–Ω—å)
‚Ä¢ –û—Ç–¥—ã—Ö–∞–π—Ç–µ –∏ –∏–∑–±–µ–≥–∞–π—Ç–µ —Å—Ç—Ä–µ—Å—Å–æ–≤
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ—Å–µ—â–∞–π—Ç–µ –≤—Ä–∞—á–∞ –¥–ª—è –ø–ª–∞–Ω–æ–≤—ã—Ö –æ—Å–º–æ—Ç—Ä–æ–≤
‚Ä¢ –í–µ–¥–∏—Ç–µ –¥–Ω–µ–≤–Ω–∏–∫ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è

–ï—Å–ª–∏ —Å–∏–º–ø—Ç–æ–º—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–Ω–µ–π –∏–ª–∏ —É—Ö—É–¥—à–∞—é—Ç—Å—è - –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.`;
  };
  
  const recommendations = getRecommendations(riskLevel, description);
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∏–º–ø—Ç–æ–º—ã –¥–ª—è fallback
  const detectedSymptoms = [];
  
  if (/–±–æ–ª—å|–±–æ–ª–∏—Ç|–±–æ–ª–µ–≤—ã–µ/i.test(description)) {
    detectedSymptoms.push({
      name: "–ë–æ–ª—å",
      severity: riskLevel === 'high' ? 'severe' : riskLevel === 'medium' ? 'moderate' : 'mild',
      urgency: riskLevel
    });
  }
  
  if (/–∫—Ä–æ–≤—å|–∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ|–∫—Ä–æ–≤–∏—Ç/i.test(description)) {
    detectedSymptoms.push({
      name: "–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ",
      severity: 'severe',
      urgency: 'high'
    });
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –ø—Ä–∏ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–∏
    if (riskLevel !== 'high') {
      console.log('FORCING HIGH RISK due to bleeding');
      riskLevel = 'high';
    }
  }
  
  if (/—Ç–æ—à–Ω–æ—Ç–∞|—Ä–≤–æ—Ç–∞|—Ç–æ—à–Ω–∏—Ç/i.test(description)) {
    detectedSymptoms.push({
      name: "–¢–æ—à–Ω–æ—Ç–∞/–†–≤–æ—Ç–∞",
      severity: riskLevel === 'high' ? 'severe' : 'moderate',
      urgency: riskLevel
    });
  }
  
  if (/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞|–∂–∞—Ä|–≥–æ—Ä—è—á/i.test(description)) {
    detectedSymptoms.push({
      name: "–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞",
      severity: 'moderate',
      urgency: 'medium'
    });
  }
  
  if (/—Å—Ö–≤–∞—Ç–∫–∏|—Å—Ö–≤–∞—Ç–∫–æ–æ–±—Ä–∞–∑–Ω|—Å–æ–∫—Ä–∞—â–µ–Ω–∏—è/i.test(description)) {
    detectedSymptoms.push({
      name: "–°—Ö–≤–∞—Ç–∫–∏",
      severity: 'severe',
      urgency: 'high'
    });
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –ø—Ä–∏ —Å—Ö–≤–∞—Ç–∫–∞—Ö
    if (riskLevel !== 'high') {
      console.log('FORCING HIGH RISK due to contractions');
      riskLevel = 'high';
    }
  }
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
  const getPersonalComment = (risk: string) => {
    if (risk === 'low') {
      return "–í–∞—à–∏ —Å–∏–º–ø—Ç–æ–º—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏. –ù–µ –≤–æ–ª–Ω—É–π—Ç–µ—Å—å, —ç—Ç–æ –æ–±—ã—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ.";
    } else if (risk === 'medium') {
      return "–°–∏–º–ø—Ç–æ–º—ã —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã. –†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –≤—Ä–∞—á–∞.";
    } else {
      return "–°–∏–º–ø—Ç–æ–º—ã —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞. –ù–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –≤—Ä–∞—á—É.";
    }
  };

  const getEducationLinks = (desc: string) => {
    const links = [];
    
    // –ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏—è - –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ —É—Ä–æ–∫–∞, –Ω–æ –µ—Å—Ç—å –æ–±—â–∏–µ –æ—Å–Ω–æ–≤—ã –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏
    if (/–∫—Ä–æ–≤—å|–∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ|–∫—Ä–æ–≤–∏—Ç/i.test(desc)) {
      links.push({
        title: "–û—Å–Ω–æ–≤—ã –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏",
        link: "pregnancy-basics",
        description: "–û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∑–¥–æ—Ä–æ–≤–æ–π –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –∫–æ–≥–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤—Ä–∞—á—É"
      });
    }
    
    // –ë–æ–ª–∏ –≤ –∂–∏–≤–æ—Ç–µ - —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –ø–æ–º–æ—á—å
    if (/–±–æ–ª—å|–±–æ–ª–∏—Ç|–∂–∏–≤–æ—Ç/i.test(desc)) {
      links.push({
        title: "–§–∏–∑–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è",
        link: "pregnancy-exercise",
        description: "–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º—ã—à—Ü"
      });
    }
    
    // –¢–æ—à–Ω–æ—Ç–∞ - –ø–∏—Ç–∞–Ω–∏–µ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ
    if (/—Ç–æ—à–Ω–æ—Ç–∞|—Ä–≤–æ—Ç–∞|—Ç–æ—à–Ω–∏—Ç/i.test(desc)) {
      links.push({
        title: "–ü–∏—Ç–∞–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏",
        link: "pregnancy-nutrition",
        description: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è –±–æ—Ä—å–±—ã —Å —Ç–æ—à–Ω–æ—Ç–æ–π –∏ —Ç–æ–∫—Å–∏–∫–æ–∑–æ–º"
      });
      links.push({
        title: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ",
        link: "pregnancy-emotional",
        description: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–º –∏ —ç–º–æ—Ü–∏—è–º–∏ –≤–æ –≤—Ä–µ–º—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏"
      });
    }
    
    // –ì–æ–ª–æ–≤–Ω—ã–µ –±–æ–ª–∏ - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ
    if (/–≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å|–≥–æ–ª–æ–≤–∞ –±–æ–ª–∏—Ç/i.test(desc)) {
      links.push({
        title: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ",
        link: "pregnancy-emotional",
        description: "–°–ø–æ—Å–æ–±—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å–æ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è"
      });
    }
    
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–æ–¥–∞–º –¥–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤
    if (/—Å—Ö–≤–∞—Ç–∫–∏|—Å–æ–∫—Ä–∞—â–µ–Ω–∏—è|—Ä–æ–¥—ã/i.test(desc)) {
      links.push({
        title: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–æ–¥–∞–º",
        link: "pregnancy-preparation",
        description: "–ö–∞–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Ä–æ–¥–∞–º –∏ —á—Ç–æ –æ–∂–∏–¥–∞—Ç—å"
      });
    }
    
    return links;
  };

  const getComfortingMessage = () => {
    return "–ù–µ –≤–æ–ª–Ω—É–π—Ç–µ—Å—å! –í–∞—à–∏ —Å–∏–º–ø—Ç–æ–º—ã —è–≤–ª—è—é—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —á–∞—Å—Ç—å—é –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏. –†–µ–∫–æ–º–µ–Ω–¥—É—é –∏–∑—É—á–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è.";
  };

  const getFollowUpAdvice = (risk: string) => {
    if (risk === 'low') {
      return "–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ —Å–∏–º–ø—Ç–æ–º–∞–º–∏. –ü—Ä–∏ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É.";
    } else if (risk === 'medium') {
      return "–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –ø—Ä–∏–µ–º –∫ –≤—Ä–∞—á—É –≤ –±–ª–∏–∂–∞–π—à–∏–µ –¥–Ω–∏. –í–µ–¥–∏—Ç–µ –¥–Ω–µ–≤–Ω–∏–∫ —Å–∏–º–ø—Ç–æ–º–æ–≤.";
    } else {
      return "–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â—å—é. –ù–µ –∂–¥–∏—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è —Å–∏–º–ø—Ç–æ–º–æ–≤.";
    }
  };

  return {
    success: true,
    riskLevel,
    symptoms: detectedSymptoms,
    recommendations,
    emergencyActions: riskLevel === 'high' ? '–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –∏–ª–∏ –≤—ã–∑–æ–≤–∏—Ç–µ —Å–∫–æ—Ä—É—é –ø–æ–º–æ—â—å (103).' : null,
    personalComment: getPersonalComment(riskLevel),
    educationLinks: getEducationLinks(description),
    comfortingMessage: riskLevel === 'low' ? getComfortingMessage() : null,
    followUpAdvice: getFollowUpAdvice(riskLevel)
  };
}
